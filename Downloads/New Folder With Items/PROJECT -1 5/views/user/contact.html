<div class="mb-4 pb-4"></div>
<div class="aside aside_right overflow-hidden cart-drawer" id="cartDrawer">
  <div class="aside-header d-flex align-items-center">
    <h3 class="text-uppercase fs-6 mb-0">SHOPPING BAG ( <span class="cart-amount js-cart-items-count">1</span> )
    </h3>
    <button class="btn-close-lg js-close-aside btn-close-aside ms-auto"></button>
  </div><!-- /.aside-header -->
  <% if (cartdata && cartdata.product.length> 0) { %>
    <div class="aside-content cart-drawer-items-list">
      <% cartdata.product.forEach(product=> { %>
        <hr class="cart-drawer-divider">
        <div class="cart-drawer-item d-flex position-relative">
          <div class="position-relative">
            <img loading="lazy" class="cart-drawer-item__img"
              src="/public/uploadImg/<%= product.productId.Image[0] %>" height="80px" width="80px" alt="">
          </div>
          <div class="cart-drawer-item__info flex-grow-1">
            <button class="btn-close-xs position-absolute top-0 end-0 js-cart-item-remove"></button>
            <h6 class="cart-drawer-item__title fw-normal">
              <%= product.productId.name %>
            </h6>
            <!-- <p class="cart-drawer-item__option text-secondary">Color: Yellow</p>
      <p class="cart-drawer-item__option text-secondary">Size: L</p> -->
            <div class="d-flex align-items-center justify-content-between mt-1">
              
              <span class="cart-drawer-item__price money price">$<%= product.productId.price %></span>
            </div>
          </div>

        </div><!-- /.cart-drawer-item d-flex -->
        <% }) %>
          <% } else { %>
            <h3>Cart is empty</h3>
            <% } %>





    </div><!-- /.aside-content -->
    <% if (cartdata && cartdata.product.length> 0) { %>
      <div class="cart-drawer-actions position-absolute start-0 bottom-0 w-100">
        <hr class="cart-drawer-divider">
      
        <a href="/cart" class="btn btn-light mt-3 d-block">View Cart</a>
        <a href="/checkout" class="btn btn-primary mt-3 d-block">Checkout</a>
      </div><!-- /.aside-content -->
      <% } else { %>
        <div></div>
        <% } %>
</div>








<script>
  const cancelorder = async (orderId) => {
   try {
     const result = await Swal.fire({
       title: "Are you sure?",
       text: "Do you want to cancel this order?",
       icon: 'warning',
       showCancelButton: true,
       confirmButtonText: "Confirm",
       cancelButtonText: "Cancel",
       reverseButtons: true,
     });
 
     if (result.isConfirmed) {
       const response = await fetch("/cancelorder", {
         method: 'PATCH',
         headers: {
           'Content-Type': 'application/json',
         },
         body: JSON.stringify({ productId: proid })
       });
 
       if (response.ok) {
         const responseData = await response.json(); // Fix here: response instead of res
         if (responseData.success) {
           Swal.fire('Cancelled!', 'Your order has been cancelled.', 'success')
             .then(() => {
               console.log("order cancelled successfully");
               window.location.href = '/orders';
             });
         } else {
           Swal.fire('Error!', 'Failed to cancel order.', 'error');
           console.log("order cancel failed");
         }
       } else {
         Swal.fire('Error!', `HTTP error: ${response.status}`, 'error');
         console.log("error occurred", response.status);
       }
     }
   } catch (error) {
     console.error("Error occurred:", error);
   }
 }
 
 
 function returnOrder(proid,) {
  const orderId = document.getElementById('returnOrderId').value;
  console.log("the order id is getting", proid, orderId);
  $('#staticBackdrop').modal('hide');
  Swal.fire({
      title: "Are you sure?",
      text: "You won't be able to revert this!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, Do it!",
      cancelButtonText: "Cancel",
  }).then((result) => {
      if (result.isConfirmed) {
          fetch('/return', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({
                      orderId: orderId, // Ensure orderId is passed as a string
                      productId: proid // Ensure proid is passed as a string
                  })
              })
              .then((response) => response.json())
              .then((response) => {
                  if (response.datelimit) {
                      Swal.fire({
                          icon: 'error',
                          title: 'Oops...',
                          text: 'Return Date expired'
                      })
                  } else if (response.return) {
                      location.reload();
                  }
              })
              .catch((error) => {
                  console.error("error occurred in fetch:", error.message)
              })
      }
  })
}

 </script>